(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{446:function(s,a,t){s.exports=t.p+"assets/img/Snipaste_2022-09-23_00-20-37.a521efb1.png"},496:function(s,a,t){"use strict";t.r(a);var n=t(33),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"类加载机制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#类加载机制"}},[s._v("#")]),s._v(" 类加载机制")]),s._v(" "),n("blockquote",[n("p",[n("a",{attrs:{href:"%5Bhttps://zhuanlan.zhihu.com/p/430979017%5D(https://zhuanlan.zhihu.com/p/430979017)"}},[s._v("JAVA之类加载机制")])]),s._v(" "),n("p",[n("a",{attrs:{href:"https://www.cnblogs.com/yuings/p/15792673.html#:~:text=%E5%9C%A8Java%E4%B8%AD%EF%BC%8C%E4%B8%80,%E4%BD%9C%E4%B8%BA%E5%85%B6%E5%94%AF%E4%B8%80%E6%A0%87%E8%AF%86%E3%80%82",target:"_blank",rel:"noopener noreferrer"}},[s._v("JVM 之 java类加载机制和类加载器(ClassLoader)的详解 - yuing_cc - 博客园 cnblogs.com"),n("OutboundLink")],1)]),s._v(" "),n("p",[n("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/343563937",target:"_blank",rel:"noopener noreferrer"}},[s._v("我竟然被“双亲委派”给虐了我竟然被“双亲委派”给虐了"),n("OutboundLink")],1)])]),s._v(" "),n("h3",{attrs:{id:"什么叫类加载"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#什么叫类加载"}},[s._v("#")]),s._v(" 什么叫类加载")]),s._v(" "),n("p",[s._v("从class文件把类对象加载到JVM内存中的过程\n加载→验证→准备→解析→初始化→使用→销毁\n"),n("em",[s._v("除了解析其他都是固定顺序，为了支持运行时绑定")])]),s._v(" "),n("p",[s._v("准备：")]),s._v(" "),n("ul",[n("li",[s._v("主要对类变量（static修饰）赋予默认值")]),s._v(" "),n("li",[s._v("如果是final修饰，直接赋予初始值")])]),s._v(" "),n("p",[s._v("初始化：")]),s._v(" "),n("ul",[n("li",[s._v("为静态变量赋值")]),s._v(" "),n("li",[s._v("执行静态代码块")])]),s._v(" "),n("p",[n("img",{attrs:{src:t(446),alt:"关系图"}})]),s._v(" "),n("h3",{attrs:{id:"类加载器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#类加载器"}},[s._v("#")]),s._v(" 类加载器")]),s._v(" "),n("ol",[n("li",[s._v("bootstrap classLoader ,根类加载器或启动类加载器，加载jvm根目录？")]),s._v(" "),n("li",[s._v("extClassLoader，扩展类加载器，负责JDK\\jre\\lib\\ext目录")]),s._v(" "),n("li",[s._v("AppClassLoader，应用类加载器/系统类加载器，主要负责加载当前应用的classpath下的所有类，开发者可以直接使用该类加载器。")]),s._v(" "),n("li",[s._v("customClassLoader,自定义类加载器，加载指定路径下的类")])]),s._v(" "),n("blockquote",[n("p",[s._v("父子加载器之前关系是继承吗？不是的，是组合而非继承，共同继承"),n("strong",[s._v("java.lang.ClassLoader")]),s._v("\n抽象类父子加载")])]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//launcher.class")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Launcher")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExtClassLoader")]),s._v(" var1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//初始化系统类加载器")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("loader "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Launcher"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("AppClassLoader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getAppClassLoader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("var1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IOException")]),s._v(" var9"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//入参为扩展类加载器")]),s._v("\n        var1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Launcher"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ExtClassLoader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getExtClassLoader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IOException")]),s._v(" var10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//扩展类加载器的入参为null，则使用bootstrapClassLoader")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExtClassLoader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("File")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" var1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IOException")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("super")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getExtURLs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("var1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ClassLoader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Launcher")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("factory"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SharedSecrets")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getJavaNetAccess")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getURLClassPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("initLookupCache")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br")])]),n("h3",{attrs:{id:"类加载机制-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#类加载机制-2"}},[s._v("#")]),s._v(" 类加载机制")]),s._v(" "),n("ol",[n("li",[s._v("全盘加载机制：当一个类加载器加载某个class时，该classs依赖的其他class都会由该加载器负责载入")]),s._v(" "),n("li",[s._v("双亲委托加载机制：如果当前加载器没有加载过该类，则每次都由父类加载器尝试去加载，所以会都会去到顶层，bootstrap classLoader去尝试加载，父类无法完成加载才会由子类自己完成")]),s._v(" "),n("li",[s._v("缓存机制：保证每次加载过的class都会缓存起来，所以每次改动都要部署")])]),s._v(" "),n("h4",{attrs:{id:"双亲委托加载机制的优点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#双亲委托加载机制的优点"}},[s._v("#")]),s._v(" 双亲委托加载机制的优点")]),s._v(" "),n("ul",[n("li",[s._v("形成一个有上及下的层级结构，避免"),n("strong",[s._v("类的重复加载")])]),s._v(" "),n("li",[s._v("安全性，防止核心API库被篡改")])]),s._v(" "),n("h4",{attrs:{id:"如何打破双亲委派机制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何打破双亲委派机制"}},[s._v("#")]),s._v(" 如何打破双亲委派机制")]),s._v(" "),n("ul",[n("li",[s._v("自定义类加载器（重新loadClass方法，null直接调用bootstrap ClassLoader）")]),s._v(" "),n("li",[s._v("通过spi机制注入")])]),s._v(" "),n("h4",{attrs:{id:"破坏双亲委派机制的例子"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#破坏双亲委派机制的例子"}},[s._v("#")]),s._v(" 破坏双亲委派机制的例子")]),s._v(" "),n("p",[s._v("JDBC：加载DriverManger的时候会加载Driver.class类，但是该类的实现都是第三方提供的，所以正常不能被根加载器加载，通过引入ThreadContextClassLoader实现")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("S")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServiceLoader")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("S")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("load")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Class")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("S")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" service"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ClassLoader")]),s._v(" cl "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("currentThread")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getContextClassLoader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServiceLoader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("load")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("service"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" cl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 第一行，获取当前线程的线程上下⽂类加载器 AppClassLoader，⽤于加载 classpath 中的具体实现类。")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("tomcat:web容器，可能部署多个应用，不同应用可能会依赖同一个第三方类库的不同版本，无法加载多个相同的类。为了实现隔离性，每一个应用自己的类加载器——WebAppClassLoader负责加载本身的目录下的class文件")]),s._v(" "),n("blockquote",[n("p",[s._v("在java中，一个类用其全限定名作为唯一标识，在jvm中，是以全限定名+类加载器名作为唯一标识")])]),s._v(" "),n("h3",{attrs:{id:"模块化技术和类加载机制-jdk9应用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#模块化技术和类加载机制-jdk9应用"}},[s._v("#")]),s._v(" 模块化技术和类加载机制（JDK9应用）")]),s._v(" "),n("p",[s._v("加载器之间关系不再是双亲委派模型的树状结构，而是复杂的网状结构。各个模块各司其职，只编译实际用到的模块，避免打包无用的类。")])])}),[],!1,null,null,null);a.default=e.exports}}]);